<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Characters Game</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.js"></script>
    <script src="jquery.ui.touch-punch.min.js"></script>
    <style>
      .wordblock {
          list-style-type: none;
	  margin: 0;
	  padding: 0;
	  user-select: none; /* prevent text selection */
	  background-color: yellow;
      }
      .wordblock li {
	  margin: 0px 0px 0px 0;
	  padding: 0px;
	  width: 50px;
	  line-height: 50px;
	  float: left;
	  display: inline-block;
	  font-size: 3em;
	  text-align: center;
	  cursor: pointer;
	  font-family: arial;
	  background: white;
      }
      table { margin-top: -6px; }
      td { padding: 2px; }
      td.unsolved { background-color: pink; }
      td.solved   { background-color: white; }
      #puzzle { display: table-cell; padding-top: 6px; }
      #puzzle.unsolved { border: solid red 1px; }
      #puzzle.solved   { border: solid white 1px; }
      .puzzletext { display: none; }
    </style>
    <script>
      $(function() {
	const lines = $('#puzzletext1').text().split("\n");
	const li = [];
	for (let i = 0; i < lines.length; i++) {
	  li.push('<table><tr><td class="unsolved"><ul class="wordblock">' + lines[i] + '</ul></td></tr></table>');
	}
	$('#puzzle').html(li.join(''));

	$('.wordblock').each(function(e) {
	  $(this).sortable();
	  $(this).disableSelection();

	  const word = $(this).text();
	  let d_word = word.split('');
	  shuffle(d_word);

	  const lis = [];
	  for (let i = 0; i < d_word.length; i++) {
	    lis.push('<li class="unsolved">' + d_word[i] + '</li>')
	  }

	  $(this).html(lis.join(''));

	  $(this).mouseup(function() {
	    setTimeout(() => {
	      let r_word = '';
	      $(this).children('li').each(function(e) {
		r_word += $(this).text();
	      });
	      if (r_word == word) {
		//console.log("YOU FOUND IT! : " + r_word);
		$(this).parent().removeClass('unsolved').addClass('solved');
		checkSolved();
	      } else {
		//console.log("Keep trying!");
		$(this).parent().removeClass('solved').addClass('unsolved');
		$('#puzzle').removeClass('solved').addClass('unsolved');
	      }
	    }, 0);
	  });
	});
      });

      function checkSolved() {
	var solved = true;
	$('.wordblock').each(function(e) {
	  if ($(this).parent().attr('class') === 'unsolved') {
	    solved = false;
	    return false;
	  }
	});
	if (solved) {
	  //console.log("Solved ENTIRE puzzle!");
	  $('#puzzle').removeClass('unsolved').addClass('solved');
	}
      }
      function shuffle(a, b, c, d) {
	c = a.length;
	while (c) b = Math.random() * (--c + 1) | 0, d = a[c], a[c] = a[b], a[b] = d
      }
    </script>
  </head>
  <body>
    <div id="puzzle" class="unsolved"></div>
    <!-- 靜夜思 -->
    <div class="puzzletext" id="puzzletext1">床前明月光
疑是地上霜
舉頭望明月
低頭思故鄉</div>
    <div class="puzzletext" id="puzzletext2">般若波羅密多心經
觀自在菩薩
行深般若波羅密多時
照見五蘊皆空
度一切苦厄
舍利子
色不異空
空不異色
色即是空
空即是色
受想行識亦復如是
舍利子
是諸法空相
不生不滅
不垢不淨
不增不減
是故空中無色
無受想行識
無眼耳鼻舌身意
無色聲香味觸法
無眼界乃至無意識界
無無明亦無無明盡
乃至無老死亦無老死盡
無苦集滅道
無智亦無得
以無所得故
菩提薩埵依般若波羅密多故
心無罣礙
無罣礙故
無有恐怖
遠離顛倒夢想
究竟涅槃
三世諸佛
依般若波羅密多故
得阿耨多羅三藐三菩提
故知般若波羅密多
是大神咒
是大明咒
是無上咒
是無等等咒
能除一切苦
真實不虛
故說般若波羅密多咒
即說咒曰
揭帝揭帝般羅揭帝般羅僧揭帝
菩提薩婆訶</div>
    <p>
      Order characters by dragging them around.
    </p>
    <p>
      Initial version from  <a href="https://stackoverflow.com/questions/42333831/javascript-drag-letters-in-word-rearrange/42334240#42334240">Stack Overflow: drag letters in word (Rearrange)</a>
    </p>
  </body>
</html>



